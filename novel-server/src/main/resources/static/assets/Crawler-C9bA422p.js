import{_ as I,r as l,d as B,e as L,c as a,a as e,w as C,v as F,f as E,g as O,F as N,h as S,t as i,o as r,n as _,i as V}from"./index-Eq2VJBny.js";import{W as j}from"./api-BxeoltIk.js";const A={class:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100"},J={class:"container mx-auto px-4 py-16"},R={class:"max-w-2xl mx-auto mb-12"},U={class:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm"},W={class:"flex flex-col sm:flex-row gap-4"},H={class:"flex-1 flex flex-col sm:flex-row gap-4"},$={class:"relative flex-1"},K=["disabled"],G={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Q={key:1,class:"animate-spin h-6 w-6",viewBox:"0 0 24 24"},q={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8"},P={class:"bg-white rounded-2xl p-8 shadow-sm"},X={key:0,class:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300"},Y={class:"flex items-start gap-4"},Z={class:"flex-1"},ee={class:"text-lg font-semibold text-gray-900"},te={class:"text-sm text-gray-500 mb-2"},oe={class:"mt-2 flex items-center gap-4"},se={class:"text-sm text-gray-500"},ne=["href"],le=["onClick"],ae={class:"flex justify-between items-center text-sm text-gray-500"},re={class:"bg-white rounded-2xl p-8 shadow-sm"},ie={class:"space-y-3"},ce={class:"flex items-start gap-3 p-3 bg-white rounded-lg shadow-sm"},de={class:"flex-1"},ue={class:"text-sm text-gray-700"},pe={class:"mt-4 p-4 bg-gray-50 rounded-xl"},ve={class:"flex justify-between items-center text-sm text-gray-500"},he=5,fe=1e3,ge={__name:"Crawler",setup(xe){const h=l(""),x=l("fuzzy"),c=l(!1),v=l([]),y=l(0),w=l("未连接"),f=l(null),g=l(null),u=l(0);let s=null,p=null;const D=n=>{try{const o=JSON.parse(n),t=JSON.parse(o.content);return{id:o.id,sourceId:o.sourceId,isStop:o.isStop,title:t.bookName,author:t.author.replace("作者：",""),latestChapter:t.latestChapter,url:t.url}}catch(o){return console.error("解析小说信息失败:",o),null}},b=()=>{(s==null?void 0:s.readyState)!==WebSocket.CONNECTING&&(s=new WebSocket(j),s.onopen=()=>{w.value="已连接",u.value=0,p&&(clearTimeout(p),p=null),d({type:"console",content:"连接成功，请输入小说名称开始搜索"})},s.onmessage=n=>{const o=JSON.parse(n.data);if(o.type==="NovelNameSearchResultMessageListener"){const t=D(o.content);t&&(y.value++,d({type:"novel",content:t,isNew:!0}),t.isStop&&(c.value=!1,d({type:"console",content:"搜索完成",isNew:!0})))}else if(o.type==="NovelNameSearchConsoleMessageListener"){const t=o.content;d({type:"console",content:t,isNew:!0}),(t.includes("错误")||t.includes("搜索完成"))&&(c.value=!1)}else o.type==="NovelDownloadConsoleMessageListener"&&(d({type:"download",content:o.content,isNew:!0}),T());M()},s.onclose=()=>{if(w.value="连接已断开",c.value=!1,u.value<he){const n=Math.min(fe*Math.pow(2,u.value),3e4);u.value++,d({type:"console",content:`连接已断开，${u.value}秒后尝试第${u.value}次重连...`}),p=setTimeout(()=>{b()},n)}else d({type:"console",content:"重连次数已达上限，请刷新页面重试"})},s.onerror=()=>{c.value=!1})},d=n=>{v.value.push(n),n.isNew&&setTimeout(()=>{n.isNew=!1},5e3)},M=()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)},T=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)},k=()=>{h.value.trim()&&(c.value=!0,v.value=[],y.value=0,s.send(JSON.stringify({type:"NovelNameSearchMessageListener",content:{bookName:h.value,searchType:x.value}})))},z=n=>{s.send(JSON.stringify({type:"NovelDownloadMessageListener",content:{searchResultId:n.id}}))};return B(()=>{b()}),L(()=>{p&&clearTimeout(p),s&&s.close()}),(n,o)=>(r(),a("div",A,[e("div",J,[e("div",R,[e("div",U,[e("div",W,[e("div",H,[e("div",$,[C(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>h.value=t),type:"text",placeholder:"输入小说名称或作者",onKeyup:E(k,["enter"]),class:"w-full pl-4 pr-12 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,544),[[F,h.value]]),e("button",{onClick:k,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-blue-500 transition-colors duration-200",disabled:c.value},[c.value?(r(),a("svg",Q,o[3]||(o[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),a("svg",G,o[2]||(o[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])))],8,K)]),C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>x.value=t),class:"w-full sm:w-auto px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white appearance-none cursor-pointer hover:bg-gray-50 transition-colors duration-200 pr-10 relative",style:{"background-image":"url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23666%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E')","background-repeat":"no-repeat","background-position":"right 8px center","background-size":"16px"}},o[4]||(o[4]=[e("option",{value:"fuzzy"},"模糊",-1),e("option",{value:"exact"},"精确",-1)]),512),[[O,x.value]])])])])]),e("div",q,[e("div",P,[o[5]||(o[5]=e("h2",{class:"text-2xl font-semibold text-gray-900 mb-6"},"搜索结果",-1)),e("div",{ref_key:"messageContainer",ref:f,class:"bg-gray-50 rounded-xl p-4 h-96 overflow-y-auto space-y-4 mb-6"},[(r(!0),a(N,null,S(v.value,(t,m)=>(r(),a("div",{key:m,class:_(["message-item",{"fade-in":t.isNew}])},[t.type==="novel"?(r(),a("div",X,[e("div",Y,[e("div",Z,[e("h3",ee,i(t.content.title),1),e("p",te,i(t.content.author),1),e("div",oe,[e("span",se,"最新章节："+i(t.content.latestChapter),1),e("a",{href:t.content.url,target:"_blank",class:"text-sm text-blue-500 hover:text-blue-600"}," 查看源网站 ",8,ne)])]),e("button",{onClick:ye=>z(t.content),class:"flex-shrink-0 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors duration-300"}," 抓取 ",8,le)])])):t.type==="console"?(r(),a("div",{key:1,class:_(["text-sm py-2 px-3 rounded-lg",{"bg-blue-50 text-blue-700":t.content.includes("成功"),"bg-yellow-50 text-yellow-700":t.content.includes("搜索"),"bg-red-50 text-red-700":t.content.includes("错误")||t.content.includes("失败"),"bg-gray-50 text-gray-700":!t.content.includes("成功")&&!t.content.includes("搜索")&&!t.content.includes("错误")&&!t.content.includes("失败")}])},i(t.content),3)):V("",!0)],2))),128))],512),e("div",ae,[e("span",null,"已找到 "+i(y.value)+" 本小说",1),e("span",null,i(w.value),1)])]),e("div",re,[o[7]||(o[7]=e("h2",{class:"text-2xl font-semibold text-gray-900 mb-6"},"下载进度",-1)),e("div",{ref_key:"downloadContainer",ref:g,class:"bg-gray-50 rounded-xl p-4 h-96 overflow-y-auto"},[e("div",ie,[(r(!0),a(N,null,S(v.value.filter(t=>t.type==="download"),(t,m)=>(r(),a("div",{key:m,class:_(["download-message",{"fade-in":t.isNew}])},[e("div",ce,[o[6]||(o[6]=e("div",{class:"text-blue-500 flex-shrink-0 mt-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",de,[e("p",ue,i(t.content),1)])])],2))),128))])],512),e("div",pe,[e("div",ve,[e("span",null,"下载消息数: "+i(v.value.filter(t=>t.type==="download").length),1)])])])])])]))}},_e=I(ge,[["__scopeId","data-v-c6c42e58"]]);export{_e as default};

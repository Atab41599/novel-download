import{_ as I,r as n,d as B,e as L,c as a,a as e,w as C,v as F,f as E,g as O,F as N,h as S,t as i,o as r,n as y,i as V}from"./index-6a8gqM8h.js";import{W as j}from"./api-CjVlgVfj.js";const A={class:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100"},J={class:"container mx-auto px-4 py-16"},R={class:"max-w-3xl mx-auto mb-12"},U={class:"relative group"},W={class:"relative p-6 sm:p-8"},H={class:"flex flex-col sm:flex-row gap-4"},$={class:"flex-1 flex flex-col sm:flex-row gap-4"},K={class:"relative flex-1"},G=["disabled"],Q={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},q={key:1,class:"animate-spin h-6 w-6",viewBox:"0 0 24 24"},P={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},X={class:"relative"},Y={class:"relative p-8"},Z={key:0,class:"bg-white/80 backdrop-blur-md rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300"},ee={class:"flex items-start gap-4"},te={class:"flex-1"},oe={class:"text-lg font-semibold text-slate-800"},se={class:"text-sm text-slate-500 mb-2"},le={class:"mt-2 flex items-center gap-4"},ne={class:"text-sm text-slate-500"},ae=["href"],re=["onClick"],ie={class:"flex justify-between items-center text-sm text-slate-500"},de={class:"relative"},ce={class:"relative p-8"},ue={class:"space-y-3"},pe={class:"flex items-start gap-3 p-3 bg-white/80 backdrop-blur-md rounded-lg shadow-sm"},ve={class:"flex-1"},he={class:"text-sm text-slate-700"},xe={class:"mt-4 p-4 bg-white/30 backdrop-blur-lg rounded-xl"},be={class:"flex justify-between items-center text-sm text-slate-500"},fe=5,we=1e3,ge={__name:"Crawler",setup(me){const h=n(""),f=n("fuzzy"),d=n(!1),v=n([]),w=n(0),g=n("未连接"),x=n(null),b=n(null),u=n(0);let s=null,p=null;const D=l=>{try{const o=JSON.parse(l),t=JSON.parse(o.content);return{id:o.id,sourceId:o.sourceId,isStop:o.isStop,title:t.bookName,author:t.author.replace("作者：",""),latestChapter:t.latestChapter,url:t.url}}catch(o){return console.error("解析小说信息失败:",o),null}},_=()=>{(s==null?void 0:s.readyState)!==WebSocket.CONNECTING&&(s=new WebSocket(j),s.onopen=()=>{g.value="已连接",u.value=0,p&&(clearTimeout(p),p=null),c({type:"console",content:"连接成功，请输入小说名称开始搜索"})},s.onmessage=l=>{const o=JSON.parse(l.data);if(o.type==="NovelNameSearchResultMessageListener"){const t=D(o.content);t&&(w.value++,c({type:"novel",content:t,isNew:!0}),t.isStop&&(d.value=!1,c({type:"console",content:"搜索完成",isNew:!0})))}else if(o.type==="NovelNameSearchConsoleMessageListener"){const t=o.content;c({type:"console",content:t,isNew:!0}),(t.includes("错误")||t.includes("搜索完成"))&&(d.value=!1)}else o.type==="NovelDownloadConsoleMessageListener"&&(c({type:"download",content:o.content,isNew:!0}),T());M()},s.onclose=()=>{if(g.value="连接已断开",d.value=!1,u.value<fe){const l=Math.min(we*Math.pow(2,u.value),3e4);u.value++,c({type:"console",content:`连接已断开，${u.value}秒后尝试第${u.value}次重连...`}),p=setTimeout(()=>{_()},l)}else c({type:"console",content:"重连次数已达上限，请刷新页面重试"})},s.onerror=()=>{d.value=!1})},c=l=>{v.value.push(l),l.isNew&&setTimeout(()=>{l.isNew=!1},5e3)},M=()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)},T=()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)},k=()=>{h.value.trim()&&(d.value=!0,v.value=[],w.value=0,s.send(JSON.stringify({type:"NovelNameSearchMessageListener",content:{bookName:h.value,searchType:f.value}})))},z=l=>{s.send(JSON.stringify({type:"NovelDownloadMessageListener",content:{searchResultId:l.id}}))};return B(()=>{_()}),L(()=>{p&&clearTimeout(p),s&&s.close()}),(l,o)=>(r(),a("div",A,[e("div",J,[o[11]||(o[11]=e("div",{class:"mb-16 text-center"},[e("h1",{class:"text-5xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent mb-4"}," 小说搜索下载 "),e("p",{class:"text-lg text-slate-600 font-light"},"智能搜索，一键下载您喜爱的小说")],-1)),e("div",R,[e("div",U,[o[5]||(o[5]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",W,[e("div",H,[e("div",$,[e("div",K,[C(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>h.value=t),type:"text",placeholder:"输入小说名称或作者",onKeyup:E(k,["enter"]),class:"w-full pl-6 pr-14 py-4 bg-white/10 backdrop-blur-sm border-0 rounded-2xl text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/20 transition-all duration-300"},null,544),[[F,h.value]]),e("button",{onClick:k,class:"absolute right-3 top-1/2 -translate-y-1/2 p-2 text-slate-400 hover:text-blue-500 transition-all duration-300 rounded-xl hover:bg-white/20",disabled:d.value},[d.value?(r(),a("svg",q,o[3]||(o[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),a("svg",Q,o[2]||(o[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])))],8,G)]),C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>f.value=t),class:"w-full sm:w-auto px-6 py-4 bg-white/10 backdrop-blur-sm border-0 rounded-2xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/20 transition-all duration-300 appearance-none cursor-pointer pr-12",style:{"background-image":"url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23666%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E')","background-repeat":"no-repeat","background-position":"right 12px center","background-size":"16px"}},o[4]||(o[4]=[e("option",{value:"fuzzy"},"模糊搜索",-1),e("option",{value:"exact"},"精确搜索",-1)]),512),[[O,f.value]])])])])])]),e("div",P,[e("div",X,[o[7]||(o[7]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",Y,[o[6]||(o[6]=e("h2",{class:"text-2xl font-semibold text-slate-800 mb-6"},"搜索结果",-1)),e("div",{ref_key:"messageContainer",ref:x,class:"bg-white/30 backdrop-blur-lg rounded-xl p-4 h-96 overflow-y-auto space-y-4 mb-6"},[(r(!0),a(N,null,S(v.value,(t,m)=>(r(),a("div",{key:m,class:y(["message-item",{"fade-in":t.isNew}])},[t.type==="novel"?(r(),a("div",Z,[e("div",ee,[e("div",te,[e("h3",oe,i(t.content.title),1),e("p",se,i(t.content.author),1),e("div",le,[e("span",ne,"最新章节："+i(t.content.latestChapter),1),e("a",{href:t.content.url,target:"_blank",class:"text-sm text-blue-500 hover:text-blue-600"}," 查看源网站 ",8,ae)])]),e("button",{onClick:ye=>z(t.content),class:"flex-shrink-0 bg-gradient-to-r from-green-400 to-green-600 text-white px-4 py-2 rounded-lg font-medium hover:from-green-500 hover:to-green-700 transition-all duration-300"}," 抓取 ",8,re)])])):t.type==="console"?(r(),a("div",{key:1,class:y(["text-sm py-2 px-3 rounded-lg font-medium",{"bg-blue-100/80 text-blue-700":t.content.includes("成功"),"bg-yellow-100/80 text-yellow-700":t.content.includes("搜索")||t.content.includes("数据源"),"bg-red-100/80 text-red-700":t.content.includes("错误")||t.content.includes("失败"),"bg-slate-100/80 text-slate-700":!t.content.includes("成功")&&!t.content.includes("搜索")&&!t.content.includes("错误")&&!t.content.includes("失败")}])},i(t.content),3)):V("",!0)],2))),128))],512),e("div",ie,[e("span",null,"已找到 "+i(w.value)+" 本小说",1),e("span",null,i(g.value),1)])])]),e("div",de,[o[10]||(o[10]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",ce,[o[9]||(o[9]=e("h2",{class:"text-2xl font-semibold text-slate-800 mb-6"},"下载进度",-1)),e("div",{ref_key:"downloadContainer",ref:b,class:"bg-white/30 backdrop-blur-lg rounded-xl p-4 h-96 overflow-y-auto"},[e("div",ue,[(r(!0),a(N,null,S(v.value.filter(t=>t.type==="download"),(t,m)=>(r(),a("div",{key:m,class:y(["download-message",{"fade-in":t.isNew}])},[e("div",pe,[o[8]||(o[8]=e("div",{class:"text-blue-500 flex-shrink-0 mt-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",ve,[e("p",he,i(t.content),1)])])],2))),128))])],512),e("div",xe,[e("div",be,[e("span",null,"下载消息数: "+i(v.value.filter(t=>t.type==="download").length),1)])])])])])])]))}},Ce=I(ge,[["__scopeId","data-v-b7acfb07"]]);export{Ce as default};
